function GenogramLayout(){go.LayeredDigraphLayout.call(this),this.initializeOption=go.LayeredDigraphLayout.InitDepthFirstIn,this.spouseSpacing=30}go.Diagram.inherit(GenogramLayout,go.LayeredDigraphLayout),GenogramLayout.prototype.makeNetwork=function(e){var o=this.createNetwork();return e instanceof go.Diagram?(this.add(o,e.nodes,!0),this.add(o,e.links,!0)):e instanceof go.Group?this.add(o,e.memberParts,!1):e.iterator&&this.add(o,e.iterator,!1),o},GenogramLayout.prototype.add=function(e,o,t){for(var n=new go.Set,i=o.iterator;i.next();){var a=i.value;if(a instanceof go.Node&&(a.isLayoutPositioned&&a.isVisible()&&(!t||null===a.containingGroup)))if(a.isLinkLabel){var r=a.labeledLink,d=r.fromNode,s=r.toNode,u=e.addNode(a);u.width=d.actualBounds.width+this.spouseSpacing+s.actualBounds.width,u.height=Math.max(d.actualBounds.height,s.actualBounds.height),u.focus=new go.Point(d.actualBounds.width+this.spouseSpacing/2,u.height/2)}else{var l=0;if(a.linksConnected.each(function(e){e.isLabeledLink&&l++}),0===l)var u=e.addNode(a);else l>1&&n.add(a)}}for(i.reset();i.next();){var r=i.value;if(r instanceof go.Link&&(r.isLayoutPositioned&&r.isVisible()&&!(t&&null!==r.containingGroup||r.isLabeledLink))){var c=e.findVertex(r.fromNode),h=e.findVertex(r.toNode);null!==h?e.linkVertexes(c,h,r):r.toNode.linksConnected.each(function(o){if(o.isLabeledLink){var t=o.labelNodes.first(),n=e.findVertex(t);null!==n&&e.linkVertexes(c,n,r)}})}}for(;n.count>0;){var a=n.first(),f=new go.Set;this.extendCohort(f,a);var g=e.createVertex();e.addVertex(g);var l=new go.Set;f.each(function(e){e.linksConnected.each(function(e){l.add(e)})}),l.each(function(o){var t=o.labelNodes.first(),n=e.findVertex(t);null!==n&&e.linkVertexes(g,n,null)}),n.removeAll(f)}},GenogramLayout.prototype.extendCohort=function(e,o){if(!e.contains(o)){e.add(o);var t=this;o.linksConnected.each(function(o){o.isLabeledLink&&(t.extendCohort(e,o.fromNode),t.extendCohort(e,o.toNode))})}},GenogramLayout.prototype.assignLayers=function(){go.LayeredDigraphLayout.prototype.assignLayers.call(this);var e=0==this.direction||180==this.direction,o=[];this.network.vertexes.each(function(t){var n=t.layer,i=o[n];i===undefined&&(i=0);var a=e?t.width:t.height;a>i&&(o[n]=a)}),this.network.vertexes.each(function(t){var n=t.layer,i=o[n];e?(t.focus=new go.Point(0,t.height/2),t.width=i):(t.focus=new go.Point(t.width/2,0),t.height=i)})},GenogramLayout.prototype.commitNodes=function(){go.LayeredDigraphLayout.prototype.commitNodes.call(this),this.network.vertexes.each(function(e){null===e.node||e.node.isLinkLabel||(e.node.position=new go.Point(e.x,e.y))});var e=this;this.network.vertexes.each(function(o){if(null!==o.node&&o.node.isLinkLabel){var t=o.node,n=t.labeledLink;n.invalidateRoute();var i=n.fromNode,a=n.toNode;if("F"===i.data.s){var r=i;i=a,a=r}var d=e.findParentsMarriageLabelNode(i),s=e.findParentsMarriageLabelNode(a);if(null!==d&&null!==s&&d.position.x>s.position.x){var r=i;i=a,a=r}if(i.position=new go.Point(o.x,o.y),a.position=new go.Point(o.x+i.actualBounds.width+e.spouseSpacing,o.y),0===i.opacity){var u=new go.Point(o.centerX-i.actualBounds.width/2,o.y);i.position=u,a.position=u}else if(0===a.opacity){var u=new go.Point(o.centerX-a.actualBounds.width/2,o.y);i.position=u,a.position=u}}}),this.network.vertexes.each(function(o){if(!(null===o.node||o.node.linksConnected.count>1)){var t=e.findParentsMarriageLabelNode(o.node);if(null!==t&&1===t.linksConnected.count){var n=e.network.findVertex(t),i=o.node.actualBounds.copy();i.x=n.centerX-o.node.actualBounds.width/2;0===e.diagram.findObjectsIn(i,function(e){return e.part},function(e){return e!==o.node},!0).count&&o.node.move(i.position)}}})},GenogramLayout.prototype.findParentsMarriageLabelNode=function(e){for(var o=e.findNodesInto();o.next();){var t=o.value;if(t.isLinkLabel)return t}return null};