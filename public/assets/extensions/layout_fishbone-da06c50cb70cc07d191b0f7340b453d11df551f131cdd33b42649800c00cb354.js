"use strict";function FishboneLayout(){go.TreeLayout.call(this),this.alignment=go.TreeLayout.AlignmentBusBranching,this.setsPortSpot=!1,this.setsChildPortSpot=!1}function FishboneLink(){go.Link.call(this)}go.Diagram.inherit(FishboneLayout,go.TreeLayout),FishboneLayout.prototype.makeNetwork=function(t){var e=go.TreeLayout.prototype.makeNetwork.call(this,t);return new go.List(go.TreeVertex).addAll(e.vertexes).each(function(t){if(0!==t.destinationEdges.count){if(t.destinationEdges.count%2==1){var o=new go.TreeVertex;o.bounds=new go.Rect,o.focus=new go.Point,e.addVertex(o),e.linkVertexes(t,o,null)}var i=new go.TreeVertex;i.bounds=t.bounds,i.focus=t.focus,e.addVertex(i),e.linkVertexes(t,i,null)}}),e},FishboneLayout.prototype.assignTreeVertexValues=function(t){go.TreeLayout.prototype.assignTreeVertexValues.call(this,t),t._direction=0,null!==t.parent&&(0===t.angle||180===t.angle?t.layerSpacing-=t.bounds.width:t.layerSpacing-=t.bounds.height)},FishboneLayout.prototype.commitNodes=function(){this.network.edges.each(function(t){var e=t.link;if(null!==e){e.fromSpot=go.Spot.None,e.toSpot=go.Spot.None;var o=t.fromVertex,i=t.toVertex;0===o.angle?e.fromSpot=go.Spot.MiddleLeft:180===o.angle&&(e.fromSpot=go.Spot.MiddleRight),0===i.angle?e.toSpot=go.Spot.MiddleLeft:180===i.angle&&(e.toSpot=go.Spot.MiddleRight)}}),this.network.vertexes.each(function(t){var e=t.children.length;if(0!==e&&null!==t.parent){var o=t.children[e-1];t.centerX=o.centerX,t.centerY=o.centerY}});var t=this;this.network.vertexes.each(function(e){null===e.parent&&t.shift(e)}),go.TreeLayout.prototype.commitNodes.call(this)},FishboneLayout.prototype.commitLinks=function(){},FishboneLayout.prototype.shift=function(t){var e=t.parent;if(null!==e&&(90===t.angle||270===t.angle)){var o=e.parent;if(null!==o){var i=t.nodeSpacing;o._direction>0?90===o.angle?0===e.angle?(t._direction=1,270===t.angle&&this.shiftAll(2,-i,e,t)):180===e.angle&&(t._direction=-1,90===t.angle&&this.shiftAll(-2,i,e,t)):270===o.angle&&(0===e.angle?(t._direction=1,90===t.angle&&this.shiftAll(2,-i,e,t)):180===e.angle&&(t._direction=-1,270===t.angle&&this.shiftAll(-2,i,e,t))):o._direction<0&&(90===o.angle?0===e.angle?(t._direction=1,90===t.angle&&this.shiftAll(2,-i,e,t)):180===e.angle&&(t._direction=-1,270===t.angle&&this.shiftAll(-2,i,e,t)):270===o.angle&&(0===e.angle?(t._direction=1,270===t.angle&&this.shiftAll(2,-i,e,t)):180===e.angle&&(t._direction=-1,90===t.angle&&this.shiftAll(-2,i,e,t))))}else{var n=0===e.angle?1:-1;t._direction=n,this.shiftAll(n,0,e,t)}}for(var r=0;r<t.children.length;r++){var s=t.children[r];this.shift(s)}},FishboneLayout.prototype.shiftAll=function(t,e,o,i){var n=i.centerX;n+=t*Math.abs(o.centerY-i.centerY)/2,n+=e,i.centerX=n;for(var r=0;r<i.children.length;r++){var s=i.children[r];this.shiftAll(t,e,o,s)}},go.Diagram.inherit(FishboneLink,go.Link),FishboneLink.prototype.computePoints=function(){var t=go.Link.prototype.computePoints.call(this);if(t)if(this.fromSpot.equals(go.Spot.MiddleRight)||this.fromSpot.equals(go.Spot.MiddleLeft)){var e,o=this.fromNode;if(0===o.findLinksInto().count){var i=this.fromPort,n=i.getDocumentPoint(go.Spot.Center),r=n.copy();r.x+=this.fromSpot.equals(go.Spot.MiddleLeft)?99999:-99999,e=this.getLinkPointFromPoint(o,i,n,r,!0).copy(),this.setPoint(0,e);var s=this.fromEndSegmentLength;isNaN(s)&&(s=i.fromEndSegmentLength),e.x+=this.fromSpot.equals(go.Spot.MiddleLeft)?s:-s,this.setPoint(1,e)}else e=this.getPoint(1);var l=this.toNode,a=this.toPort,h=a.getDocumentPoint(go.Spot.Center),g=h.copy();g.x+=this.fromSpot.equals(go.Spot.MiddleLeft)?-49999.5:49999.5,g.y+=h.y<e.y?99999:-99999;var d=this.getLinkPointFromPoint(l,a,h,g,!1);this.setPoint(2,d);var c=Math.abs(d.y-e.y)/2;this.fromSpot.equals(go.Spot.MiddleLeft)&&(c=-c),this.insertPoint(2,new go.Point(d.x+c,e.y))}else if(this.toSpot.equals(go.Spot.MiddleRight)||this.toSpot.equals(go.Spot.MiddleLeft)){var e=this.getPoint(1),o=this.fromNode,i=this.fromPort,f=o.findLinksInto().first(),n=i.getDocumentPoint(go.Spot.Center),g=n.copy();g.x+=null!==f&&f.fromSpot.equals(go.Spot.MiddleLeft)?-49999.5:49999.5,g.y+=n.y<e.y?99999:-99999;var p=this.getLinkPointFromPoint(o,i,n,g,!0);this.setPoint(0,p);var c=Math.abs(e.y-p.y)/2;null!==f&&f.fromSpot.equals(go.Spot.MiddleLeft)&&(c=-c),this.insertPoint(1,new go.Point(p.x+c,e.y))}return t};