GoTools.prototype.makeGroupTemplateMap=function(){function t(t,o){var e=[],n=t.data.startpoint.copy(),a=t.data.endpoint.copy(),r=n.x+n.y<=a.x+a.y?n:a,i=n.x+n.y>a.x+a.y?n:a,l=[];t.memberParts.iterator.each(function(t){var o=getWallPartEndpoints(t);l.push(o[0]),l.push(o[1])}),l.sort(function(t,o){return t.x+t.y>o.x+o.y?1:t.x+t.y<o.x+o.y?-1:0}),e.push(r),e=e.concat(l),e.push(i);for(var d=[],g=0;g<e.length;g+=2){var c=e[g],p=e[g+1];Math.sqrt(c.distanceSquaredPoint(p))>=o.data.width&&d.push({pt1:c,pt2:p})}for(var s=Number.MAX_VALUE,u=null,g=0;g<d.length;g++){var m=d[g],f=m.pt1,b=m.pt2,h=Math.sqrt(f.distanceSquaredPoint(o.location)),y=Math.sqrt(b.distanceSquaredPoint(o.location));h<s&&(s=h,u=m),y<s&&(s=y,u=m)}if(null===u)return null;var P=Math.sqrt(u.pt1.distanceSquaredPoint(u.pt2)),S=o.data.width/2,c=new go.Point(u.pt1.x+S/P*(u.pt2.x-u.pt1.x),u.pt1.y+S/P*(u.pt2.y-u.pt1.y)),p=new go.Point(u.pt2.x+S/P*(u.pt1.x-u.pt2.x),u.pt2.y+S/P*(u.pt1.y-u.pt2.y));return o.location.copy().projectOntoLineSegmentPoint(c,p)}var o=go.GraphObject.make;this.groupTemplateMap.add("FloorPlannerDefault",o(go.Group,"Vertical",{contextMenu:makeContextMenu(),doubleClick:function(t){t.diagram.floorplanUI&&t.diagram.floorplanUI.hideShow("selectionInfoWindow")},toolTip:o(go.Adornment,"Auto",o(go.Shape,{fill:"#FFFFCC"}),o(go.TextBlock,{margin:4},new go.Binding("text","",function(t,o){var e=o.part.adornedObject.data;return"Name: "+("MultiPurposeNode"===o.part.adornedObject.category?e.text:e.caption)+"\nNotes: "+e.notes+"\nMembers: "+o.part.adornedObject.memberParts.count}).ofObject()))},new go.Binding("location","loc"),o(go.Panel,"Auto",o(go.Shape,"RoundedRectangle",{fill:"rgba(128,128,128,0.15)",stroke:"rgba(128, 128, 128, .05)",name:"SHAPE",strokeCap:"square"},new go.Binding("fill","isSelected",function(t){return t?"rgba(128, 128, 128, .15)":"rgba(128, 128, 128, 0.10)"}).ofObject()),o(go.Placeholder,{padding:5})))),this.groupTemplateMap.add("WallGroup",o(go.Group,"Spot",{contextMenu:makeContextMenu(),toolTip:o(go.Adornment,"Auto",o(go.Shape,{fill:"#FFFFCC"}),o(go.TextBlock,{margin:4},new go.Binding("text","",function(t,o){var e=o.part.adornedObject.data;return"Name: "+("MultiPurposeNode"===o.part.adornedObject.category?e.text:e.caption)+"\nNotes: "+e.notes+"\nMembers: "+o.part.adornedObject.memberParts.count}).ofObject())),selectionObjectName:"SHAPE",rotateObjectName:"SHAPE",locationSpot:go.Spot.Center,reshapable:!0,minSize:new go.Size(1,1),dragComputation:function(t,o){var e=t.diagram;e.updateWallDimensions(),e.updateWallAngles();var n=t.diagram.grid,a=t.data.startpoint.copy(),r=t.data.endpoint.copy(),i=o.x-t.location.x,l=o.y-t.location.y,d=a.offset(i,l),g=r.offset(i,l);return e.toolManager.draggingTool.isGridSnapEnabled&&(d=d.snapToGridPoint(n.gridOrigin,n.gridCellSize),g=g.snapToGridPoint(n.gridOrigin,n.gridCellSize)),e.model.setDataProperty(t.data,"startpoint",d),e.model.setDataProperty(t.data,"endpoint",g),new go.Point((d.x+g.x)/2,(d.y+g.y)/2)},selectionAdorned:!1,mouseDrop:function(o,e){var n=o.diagram,a=n.selection.first();if(a&&("WindowNode"===a.category||"DoorNode"===a.category)&&null===a.containingGroup){var r=t(e,a);if(null===r)return n.remove(a),void alert("There's not enough room on the wall!");e.findObject("SHAPE").stroke="black",n.model.setDataProperty(a.data,"group",e.data.key),a.location=r.projectOntoLineSegmentPoint(e.data.startpoint,e.data.endpoint),a.angle=e.rotateObject.angle,"WindowNode"===a.category&&n.model.setDataProperty(a.data,"height",e.data.strokeWidth),"DoorNode"===a.category&&n.model.setDataProperty(a.data,"doorOpeningHeight",e.data.strokeWidth)}n.floorplanUI&&n.floorplanUI.setSelectionInfo(n.selection.first(),n),n.updateWallDimensions()},mouseDragEnter:function(t,o){t.diagram.toolManager.draggingTool.draggingParts.iterator.each(function(t){"WindowNode"!==t.category&&"DoorNode"!==t.category||null!==t.containingGroup||(o.findObject("SHAPE").stroke="lightblue",t.angle=o.rotateObject.angle)})},mouseDragLeave:function(t,o){var e=t.diagram;o.findObject("SHAPE").stroke="black",e.toolManager.draggingTool.draggingParts.iterator.each(function(t){"WindowNode"!==t.category&&"DoorNode"!==t.category||null!==t.containingGroup||(t.angle=0)})},doubleClick:function(t){t.diagram.floorplanUI&&t.diagram.floorplanUI.hideShow("selectionInfoWindow")}},o(go.Shape,{strokeWidth:1,name:"SHAPE",fill:"black",stroke:"red",geometry:new go.Geometry(go.Geometry.Line),isGeometryPositioned:!0},new go.Binding("strokeWidth","strokeWidth"),new go.Binding("stroke","isSelected",function(t,o){if(null!=o.part.containingGroup){var e=o.part.containingGroup;t&&(e.data.isSelected=!0)}return t?"dodgerblue":"black"}).ofObject()))),this.groupTemplateMap.add("sequence",o(go.Group,"Vertical",{locationSpot:go.Spot.Bottom,locationObjectName:"HEADER",minLocation:new go.Point(0,0),maxLocation:new go.Point(9999,0),selectionObjectName:"HEADER"},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),o(go.Panel,"Auto",{name:"HEADER"},o(go.Shape,"Rectangle",{fill:o(go.Brush,"Linear",{0:"#bbdefb",1:go.Brush.darkenBy("#bbdefb",.1)}),stroke:null}),o(go.TextBlock,{margin:5,font:"400 10pt Source Sans Pro, sans-serif"},new go.Binding("text","text"))),o(go.Shape,{figure:"LineV",fill:null,stroke:"gray",strokeDashArray:[3,3],width:1,alignment:go.Spot.Center,portId:"",fromLinkable:!0,fromLinkableDuplicates:!0,toLinkable:!0,toLinkableDuplicates:!0,cursor:"pointer"},new go.Binding("height","duration",function(t){return LinePrefix+t*MessageSpacing+LineSuffix}))))};