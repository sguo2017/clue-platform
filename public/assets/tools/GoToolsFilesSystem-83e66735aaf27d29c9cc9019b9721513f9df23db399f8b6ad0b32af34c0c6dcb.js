function GoToolsFilesSystem(o,e){this._goTools=o,this._UNSAVED_FILENAME="(Unsaved File)",this._DEFAULT_MODELDATA={units:"centimeters",unitsAbbreviation:"cm",gridSize:10,wallWidth:5,preferences:{showWallGuidelines:!0,showWallLengths:!0,showWallAngles:!0,showOnlySmallWallAngles:!0,showGrid:!0,gridSnap:!0}},this._state=e}function checkLocalStorage(){try{return window.localStorage.setItem("item","item"),window.localStorage.removeItem("item"),!0}catch(o){return!1}}function updateFileList(o){for(var e,t=document.getElementById(o);e=t.lastChild;)t.removeChild(e);for(key in window.localStorage){if(window.localStorage.getItem(key)){var s=document.createElement("option");s.value=key,s.text=key,t.add(s,null)}}}function openWindow(o,e){var t=document.getElementById(o);"hidden"===t.style.visibility&&(updateFileList(e),t.style.visibility="visible")}Object.defineProperty(GoToolsFilesSystem.prototype,"goTools",{get:function(){return this._goTools}}),Object.defineProperty(GoToolsFilesSystem.prototype,"UNSAVED_FILENAME",{get:function(){return this._UNSAVED_FILENAME}}),Object.defineProperty(GoToolsFilesSystem.prototype,"DEFAULT_MODELDATA",{get:function(){return this._DEFAULT_MODELDATA}}),Object.defineProperty(GoToolsFilesSystem.prototype,"state",{get:function(){return this._state}}),GoToolsFilesSystem.prototype.newGoTools=function(){var o=this.goTools;if(o.isModified){confirm("Would you like to save changes to "+this.getCurrentFileName()+"?")&&this.saveGoTools()}this.setCurrentFileName(this.UNSAVED_FILENAME);var e=new go.GraphLinksModel;e.modelData=this.DEFAULT_MODELDATA,o.model=e,o.undoManager.isEnabled=!0,o.isModified=!1,o.goToolsUI&&o.goToolsUI.updateUI()},GoToolsFilesSystem.prototype.saveGoTools=function(){if(checkLocalStorage()){var o=this.getCurrentFileName();o===this.UNSAVED_FILENAME?this.saveGoToolsAs():(window.localStorage.setItem(o,this.goTools.model.toJson()),this.goTools.isModified=!1)}},GoToolsFilesSystem.prototype.saveGoToolsAs=function(){if(checkLocalStorage()){var o=prompt("Save file as...",this.getCurrentFileName());if(o&&o!==this.UNSAVED_FILENAME){var e=!0;null!==window.localStorage.getItem(o)&&(e=confirm("Do you want to overwrite "+o+"?")),e&&(this.setCurrentFileName(o),window.localStorage.setItem(o,this.goTools.model.toJson()),this.goTools.isModified=!1)}}},GoToolsFilesSystem.prototype.loadGoTools=function(){for(var o=this.goTools,e=document.getElementById(this.state.filesToOpenListId),t=undefined,s=0;s<e.options.length;s++)e.options[s].selected&&(t=e.options[s].text);if(t!==undefined){var i=window.localStorage.getItem(t);this.loadGoToolsFromModel(i),o.isModified=!1,this.setCurrentFileName(t)}o.goToolsUI&&o.goToolsUI.closeElement(this.state.openWindowId)},GoToolsFilesSystem.prototype.loadGoToolsFromModel=function(o){var e=this.goTools;e.layout=go.GraphObject.make(go.Layout),e.model=go.Model.fromJson(o),e.skipsUndoManager=!0,e.startTransaction("generate walls"),e.nodes.each(function(o){"WallGroup"===o.category&&e.updateWall(o)}),e.goToolsUI&&e.goToolsUI.updateUI(),e.commitTransaction("generate walls"),e.undoManager.isEnabled=!0},GoToolsFilesSystem.prototype.removeGoTools=function(){for(var o=this.goTools,e=document.getElementById(this.state.filesToRemoveListId),t=undefined,s=0;s<e.options.length;s++)e.options[s].selected&&(t=e.options[s].text);t!==undefined&&window.localStorage.removeItem(t),o.goToolsUI&&o.goToolsUI.closeElement(this.state.removeWindowId)},GoToolsFilesSystem.prototype.showOpenWindow=function(){if(checkLocalStorage()){if(this.goTools.isModified){confirm("Would you like to save changes to "+this.getCurrentFileName()+"?")&&this.saveGoTools()}openWindow(this.state.openWindowId,this.state.filesToOpenListId)}},GoToolsFilesSystem.prototype.showRemoveWindow=function(){checkLocalStorage()&&openWindow(this.state.removeWindowId,this.state.filesToRemoveListId)},GoToolsFilesSystem.prototype.setCurrentFileName=function(o){var e=document.getElementById(this.state.currentFileId);this.goTools.isModified&&(o+="*"),e.textContent=o},GoToolsFilesSystem.prototype.getCurrentFileName=function(){var o=document.getElementById(this.state.currentFileId),e=o.textContent;return"*"===e[e.length-1]?e.substr(0,e.length-1):e};